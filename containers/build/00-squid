#!/bin/bash

docker pull sameersbn/squid
/usr/sbin/useradd -r -s /sbin/nologin squid
docker volume create squid_spool
docker volume create squid_conf
cat > /var/lib/docker/volumes/squid_conf/_data/squid.conf <<'EOF'
acl localnet src 0.0.0.1-0.255.255.255
acl localnet src 172.20.0.0/24
acl localnet src 169.254.0.0/16
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_port 3128
EOF
chown -R squid /var/lib/docker/volumes/squid_conf/_data/
